<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PS4 Cheat Browser â€” GoldHEN (Supabase)</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Share+Tech+Mono&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f0f4f8;
    --surface: #ffffff;
    --card: #ffffff;
    --border: #d1dce5;
    --accent: #0099cc;
    --accent2: #e74c3c;
    --text: #2c3e50;
    --muted: #7f8c8d;
    --muted2: #95a5a6;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,153,204,0.05) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,153,204,0.05) 1px, transparent 1px);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1000px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  .header { text-align: center; margin-bottom: 48px; }

  .header .eyebrow {
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    letter-spacing: 5px;
    color: var(--accent);
    opacity: 0.7;
    margin-bottom: 10px;
  }

  .header h1 {
    font-size: clamp(42px, 8vw, 72px);
    font-weight: 800;
    letter-spacing: 3px;
    line-height: 1;
    color: #2c3e50;
    text-transform: uppercase;
  }

  .header h1 em {
    font-style: normal;
    color: var(--accent);
    text-shadow: 0 0 10px rgba(0,153,204,0.2);
  }

  .header p { margin-top: 14px; color: var(--muted2); font-size: 16px; letter-spacing: 1px; }

  /* Source panel */
  .source-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 28px;
    margin-bottom: 28px;
  }

  .source-panel h2 {
    font-size: 18px; font-weight: 700; letter-spacing: 2px;
    text-transform: uppercase; color: var(--text); margin-bottom: 20px;
  }

  .db-load-btn {
    display: flex; align-items: center; gap: 12px;
    padding: 14px 28px;
    background: linear-gradient(135deg, var(--accent), #007aa3);
    border: 1px solid var(--accent);
    border-radius: 8px; color: #fff;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 18px; font-weight: 700; letter-spacing: 2px;
    cursor: pointer; transition: all 0.25s;
    width: 100%; justify-content: center; text-transform: uppercase;
  }

  .db-load-btn:hover {
    border-color: var(--accent);
    box-shadow: 0 0 20px rgba(0,212,255,0.2);
  }

  .db-load-btn:disabled { opacity: 0.6; cursor: not-allowed; }

  .config-note {
    margin-top: 10px; font-size: 13px; color: var(--muted);
    font-family: 'Share Tech Mono', monospace; text-align: center; letter-spacing: 0.5px;
  }

  /* Stats */
  .stats-row { display: flex; gap: 20px; margin-bottom: 24px; flex-wrap: wrap; align-items: center; }

  .stat { font-family: 'Share Tech Mono', monospace; }
  .stat .val { font-size: 24px; color: var(--accent); font-weight: bold; line-height: 1; }
  .stat .lbl { font-size: 11px; color: var(--muted2); letter-spacing: 1px; margin-top: 2px; }
  .stat-divider { width: 1px; height: 32px; background: var(--border); }

  /* Search */
  .search-wrap { position: relative; margin-bottom: 8px; }

  .search-wrap svg {
    position: absolute; left: 16px; top: 50%; transform: translateY(-50%);
    color: var(--muted); width: 20px; height: 20px; pointer-events: none;
  }

  #searchInput {
    width: 100%; padding: 16px 16px 16px 50px;
    background: var(--surface); border: 1.5px solid var(--border);
    border-radius: 10px; color: var(--text);
    font-family: 'Barlow Condensed', sans-serif; font-size: 22px;
    font-weight: 600; letter-spacing: 1px; outline: none; transition: all 0.2s;
  }

  #searchInput:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,212,255,0.08); }
  #searchInput::placeholder { color: var(--muted); }

  .search-hint { font-size: 13px; color: var(--muted); font-family: 'Share Tech Mono', monospace; letter-spacing: 0.5px; margin-bottom: 20px; }

  /* Results */
  #results { display: flex; flex-direction: column; gap: 12px; }

  .no-results { text-align: center; padding: 60px; color: var(--muted2); font-size: 20px; letter-spacing: 1px; }
  .no-results .emoji { font-size: 48px; display: block; margin-bottom: 16px; }

  /* Game Card */
  .game-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 12px; overflow: hidden; transition: border-color 0.2s;
    animation: fadeUp 0.18s ease both;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .game-card:hover { border-color: var(--accent); box-shadow: 0 2px 8px rgba(0,153,204,0.1); }

  .game-header {
    display: flex; align-items: center; gap: 16px;
    padding: 14px 16px; cursor: pointer;
  }

  .game-header:hover { background: rgba(0,153,204,0.03); }

  .cover-wrap {
    flex-shrink: 0; width: 96px; height: 96px; border-radius: 8px;
    overflow: hidden; background: linear-gradient(135deg, #e8f0f5, #f5f8fa); border: 2px solid var(--border);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  .cover-wrap img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .cover-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 26px; }

  .game-info { flex: 1; min-width: 0; }

  .game-name {
    font-size: 20px; font-weight: 700; color: var(--text);
    letter-spacing: 0.5px; line-height: 1.2;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }

  .game-name mark { background: rgba(0,212,255,0.18); color: var(--accent); border-radius: 2px; padding: 0 2px; }

  .game-id-row { display: flex; align-items: center; gap: 10px; margin-top: 5px; flex-wrap: wrap; }

  .game-id {
    font-family: 'Share Tech Mono', monospace;
    font-size: 20px; font-weight: bold; color: var(--accent);
    letter-spacing: 2px; background: rgba(0,153,204,0.1);
    padding: 4px 14px; border-radius: 6px; border: 1px solid rgba(0,153,204,0.3);
  }

  .game-id mark { background: rgba(0,212,255,0.3); color: #fff; border-radius: 2px; }

  .tag { font-family: 'Share Tech Mono', monospace; font-size: 11px; color: var(--muted2); letter-spacing: 1px; }

  .card-right { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; flex-shrink: 0; }

  .cheat-count {
    font-family: 'Share Tech Mono', monospace; font-size: 13px;
    color: var(--accent2); border: 1px solid rgba(255,60,110,0.25);
    padding: 3px 12px; border-radius: 20px; white-space: nowrap;
  }

  .chevron { color: var(--muted); transition: transform 0.25s; }
  .game-card.open .chevron { transform: rotate(180deg); }

  /* Cheats body */
  .cheats-body { display: none; border-top: 1px solid var(--border); }
  .game-card.open .cheats-body { display: block; }

  .cheats-grid {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .cheat-item { background: var(--card); padding: 12px 18px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border); }
  .cheat-item:last-child { border-bottom: none; }

  .cheat-dot {
    width: 5px; height: 5px; border-radius: 50%;
    background: var(--accent2); flex-shrink: 0;
    box-shadow: 0 0 6px rgba(255,60,110,0.6);
  }

  .cheat-name { font-size: 15px; font-weight: 600; color: var(--text); flex: 1; letter-spacing: 0.3px; }
  .cheat-type { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }

  .card-footer {
    padding: 10px 18px; border-top: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;
  }

  .credits-text { font-family: 'Share Tech Mono', monospace; font-size: 11px; color: var(--muted); }
  .credits-text span { color: rgba(0,212,255,0.5); }
  .proc-text { font-family: 'Share Tech Mono', monospace; font-size: 11px; color: var(--muted); }

  #searchSection { display: none; }

  #scrollTop {
    position: fixed; bottom: 24px; right: 24px;
    width: 42px; height: 42px; border-radius: 50%;
    background: var(--accent); border: none; color: #fff; box-shadow: 0 4px 12px rgba(0,153,204,0.3);
    cursor: pointer; display: flex; align-items: center;
    justify-content: center; opacity: 0; pointer-events: none;
    transition: opacity 0.2s; z-index: 100; font-size: 20px; font-weight: bold;
  }

  #scrollTop.visible { opacity: 1; pointer-events: all; }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="eyebrow">// GoldHEN Cheat Repository â€” Supabase Powered</div>
    <h1>PS4 <em>CHEAT</em> BROWSER</h1>
    <p>Search across 1700+ game cheats â€” instant loading from database</p>
  </div>

  <div class="source-panel">
    <h2>ðŸ“¡ Load Cheat Database</h2>
    <button class="db-load-btn" id="dbLoadBtn" onclick="loadFromSupabase()">
      Load from Database
    </button>
    <div class="config-note">Fast loading from Supabase â€” configure in sync-to-supabase.html</div>
  </div>

  <div id="searchSection">
    <div class="stats-row" id="statsRow"></div>
    <div class="search-wrap">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35M17 11A6 6 0 1 1 5 11a6 6 0 0 1 12 0z"/>
      </svg>
      <input type="text" id="searchInput" placeholder="Search by name or ID (e.g. CUSA00002, shadow fall)..." autocomplete="off" spellcheck="false">
    </div>
    <div class="search-hint">Partial match â€” type any word or part of the game ID</div>
    <br>
    <div id="results"></div>
  </div>
</div>

<button id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">â†‘</button>

<script>
  let allGames = [];
  let supabase = null;

  // Initialize Supabase
  const SUPABASE_URL = localStorage.getItem('supabaseUrl') || 'https://bnljbsdbosnxsgvriosr.supabase.co';
  const SUPABASE_KEY = localStorage.getItem('supabaseKey') || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJubGpic2Rib3NueHNndnJpb3NyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NDA4NDQsImV4cCI6MjA4NzIxNjg0NH0.KBiswV89XDnjtWMOFk4VGhjcwapHEsLhdpX_2K60p7c';
  
  if (SUPABASE_URL && SUPABASE_KEY && SUPABASE_URL !== 'https://bnljbsdbosnxsgvriosr.supabase.co') {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  }

  // Custom cover URLs matched by game name (case-insensitive)
  const customCoversByName = {
    'call of duty black ops iii': 'https://images.pushsquare.com/83c6354db18f1/call-of-duty-black-ops-iii-cover.cover_large.jpg'
    // Add more covers here
  };

  async function loadFromSupabase() {
    const btn = document.getElementById('dbLoadBtn');
    
    if (!supabase) {
      alert('Supabase not configured! Please open sync-to-supabase.html and set up your credentials.');
      return;
    }
    
    btn.disabled = true;
    btn.textContent = 'Loading from Database...';

    try {
      console.log('ðŸ”„ Fetching games from Supabase...');
      
      const { data: games, error } = await supabase
        .from('games')
        .select(`
          id,
          name,
          version,
          process,
          credits,
          cheats (
            name,
            type
          )
        `);
      
      if (error) throw error;
      
      console.log(`âœ… Loaded ${games.length} games from database`);
      
      allGames = games.map(g => ({
        id: g.id,
        name: g.name,
        version: g.version,
        process: g.process,
        credits: g.credits,
        mods: g.cheats || []
      }));
      
      allGames.sort((a,b) => (a.name||'').localeCompare(b.name||''));
      showSearchSection();
      
    } catch(err) {
      console.error('âŒ Error loading from Supabase:', err);
      alert('Error loading from database: ' + err.message);
      btn.disabled = false;
      btn.textContent = 'Retry';
    }
  }

  function showSearchSection() {
    document.getElementById('searchSection').style.display = 'block';
    updateStats('');
    renderResults('');
    setTimeout(() => document.getElementById('searchInput').focus(), 100);
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('searchInput').addEventListener('input', () => {
      const q = document.getElementById('searchInput').value.trim();
      updateStats(q);
      renderResults(q);
    });
  });

  function filterGames(q) {
    if (!q) return allGames;
    const tokens = q.toLowerCase().split(/\s+/).filter(Boolean);
    return allGames.filter(g => {
      const hay = ((g.name || '') + ' ' + (g.id || '')).toLowerCase();
      return tokens.every(t => hay.includes(t));
    });
  }

  function updateStats(q) {
    const filtered = filterGames(q);
    const total = filtered.reduce((s,g) => s + (g.mods ? g.mods.length : 0), 0);
    document.getElementById('statsRow').innerHTML = `
      <div class="stat"><div class="val">${allGames.length}</div><div class="lbl">TOTAL GAMES</div></div>
      <div class="stat-divider"></div>
      <div class="stat"><div class="val">${filtered.length}</div><div class="lbl">SHOWN</div></div>
      <div class="stat-divider"></div>
      <div class="stat"><div class="val">${total}</div><div class="lbl">CHEATS</div></div>
    `;
  }

  function escHtml(s) {
    if (s == null || s === undefined) return '';
    const str = String(s);
    if (!str) return '';
    return str
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;');
  }

  function highlight(text, q) {
    if (!text || text === undefined) return '';
    if (!q) return escHtml(text);
    const safe = escHtml(text);
    const tokens = q.toLowerCase().split(/\s+/).filter(Boolean);
    let result = safe;
    tokens.forEach(t => {
      const regex = new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      result = result.replace(regex, '<mark>$1</mark>');
    });
    return result;
  }

  function coverHtml(id, gameName) {
    if (!id) return `<div class="cover-placeholder" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ðŸŽ®</div>`;
    
    const cleanId = String(id).trim();
    const cleanName = gameName ? String(gameName).trim().toLowerCase() : '';
    
    // Check if game name matches any custom covers
    for (const [namePattern, coverUrl] of Object.entries(customCoversByName)) {
      if (cleanName.includes(namePattern)) {
        return `<img src="${coverUrl}" alt="${escHtml(gameName)}" loading="lazy" onerror="this.outerHTML='<div class=\\'cover-placeholder\\' style=\\'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 36px; font-weight: 800;\\'>ðŸŽ®</div>';">`;
      }
    }
    
    // Generate fallback gradient
    const colors = [
      ['#667eea', '#764ba2'], ['#f093fb', '#f5576c'], ['#4facfe', '#00f2fe'],
      ['#43e97b', '#38f9d7'], ['#fa709a', '#fee140'], ['#30cfd0', '#330867'],
      ['#a8edea', '#fed6e3'], ['#ff9a56', '#ff6a88'], ['#ffecd2', '#fcb69f'], ['#ff6e7f', '#bfe9ff']
    ];
    let hash = 0;
    for (let i = 0; i < id.length; i++) {
      hash = id.charCodeAt(i) + ((hash << 5) - hash);
    }
    const colorIndex = Math.abs(hash) % colors.length;
    const [color1, color2] = colors[colorIndex];
    const letter = (gameName && gameName[0]) || (id && id[0]) || '?';
    return `<div class="cover-placeholder" style="background: linear-gradient(135deg, ${color1} 0%, ${color2} 100%); color: white; font-size: 36px; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">${escHtml(letter.toUpperCase())}</div>`;
  }

  let renderTimer;
  function renderResults(q) {
    clearTimeout(renderTimer);
    renderTimer = setTimeout(() => _render(q), 60);
  }

  function _render(q) {
    const resultsEl = document.getElementById('results');
    const games = filterGames(q);

    if (!games.length) {
      resultsEl.innerHTML = `<div class="no-results"><span class="emoji">ðŸŽ®</span>No games found${q ? ` for "<strong>${escHtml(q)}</strong>"` : ''}</div>`;
      return;
    }

    const show = games.slice(0, 200);

    resultsEl.innerHTML = show.map((g, i) => {
      const id = g.id || '';
      const mods = g.mods || [];

      const cheatsHtml = mods.map(mod => {
        const modName = (mod && mod.name != null) ? String(mod.name) : '';
        const modType = (mod && mod.type != null) ? String(mod.type) : '';
        return `
          <div class="cheat-item">
            <div class="cheat-dot"></div>
            <div class="cheat-name">${escHtml(modName)}</div>
            <div class="cheat-type">${escHtml(modType)}</div>
          </div>`;
      }).join('');

      const creditsHtml = Array.isArray(g.credits) && g.credits.length
        ? `<span class="credits-text">by <span>${g.credits.map(c => escHtml(String(c))).join(', ')}</span></span>`
        : '<span></span>';

      const procHtml = g.process
        ? `<span class="proc-text">${escHtml(String(g.process))}</span>`
        : '<span></span>';

      return `
        <div class="game-card" id="card-${i}">
          <div class="game-header" onclick="toggleCard(${i})">
            <div class="cover-wrap">${coverHtml(id, g.name)}</div>
            <div class="game-info">
              <div class="game-name">${highlight(g.name || 'Unknown', q)}</div>
              <div class="game-id-row">
                <span class="game-id">${highlight(id, q)}</span>
                <span class="tag">v${escHtml(String(g.version || '?'))}</span>
              </div>
            </div>
            <div class="card-right">
              <span class="cheat-count">${mods.length} cheat${mods.length !== 1 ? 's' : ''}</span>
              <svg class="chevron" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </div>
          </div>
          <div class="cheats-body">
            <div class="cheats-grid">${cheatsHtml}</div>
            <div class="card-footer">${creditsHtml}${procHtml}</div>
          </div>
        </div>`;
    }).join('');

    if (games.length > 200) {
      resultsEl.innerHTML += `<div class="no-results" style="padding:20px;font-size:15px">...and ${games.length - 200} more results. Narrow your search.</div>`;
    }
  }

  function toggleCard(i) {
    document.getElementById('card-' + i).classList.toggle('open');
  }

  window.addEventListener('scroll', () => {
    document.getElementById('scrollTop').classList.toggle('visible', window.scrollY > 400);
  });
</script>
</body>
</html>
